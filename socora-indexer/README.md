# Socora Indexer

The Socora indexer turns crawler artifacts into retrieval-ready knowledge stores using [LlamaIndex](https://www.llamaindex.ai/). It ingests normalized page content, builds embeddings, and exposes query interfaces for downstream agents and applications.

## Goals
- Transform `socora-crawler` outputs into structured document nodes with rich metadata.
- Support incremental indexing and change detection to keep civic data fresh.
- Provide reusable pipelines for retrieval-augmented generation (RAG) workloads across municipalities and agencies.

## Project Layout
- `main.py` — entry point for prototyping index builds and ad-hoc experiments.
- `pyproject.toml` — uv-managed dependency list (LlamaIndex, vector backends, utilities).
- `.venv/` — optional virtual environment created by uv.

## Setup
```powershell
uv sync
```
Define your embedding or vector store credentials via environment variables before running pipelines (for example `OPENAI_API_KEY`, `AZURE_OPENAI_ENDPOINT`, `QDRANT_URL`, etc.).

## Running
```powershell
uv run python main.py --run-dir ..\output\run-20250921-120000 --index-dir ..\output\indexes\cresskill
```
Arguments:
- `--run-dir` (required) — path to a crawler run that contains `metadata.json`, `content.json`, and optional `content.md` files.
- `--index-dir` — destination for serialized index artifacts (defaults to `./data/indexes`).
- `--chunk-size`, `--chunk-overlap` — tuning parameters forwarded to LlamaIndex node parsers.

Adapt `main.py` or add new modules for production workflows (scheduled re-indexing, evaluation suites, API adapters, etc.).

## Data Contracts
Crawler outputs consumed by the indexer live under `../output/run-*/` and include:
- `metadata.json` — page URL, final URL, status, timestamps, detected content type, downloaded file references.
- `content.json` — ordered DOM content with text and embed metadata.
- `content.md` — normalized Markdown generated by the normalization script.

Future revisions will publish a formal schema document to keep contracts stable across modules.

## Roadmap
1. Support streaming ingestion from cloud object storage.
2. Integrate vector databases (Qdrant, Weaviate, or OpenSearch vector extensions).
3. Ship evaluation harnesses that measure recall and answer quality for civic queries.
4. Expose gRPC/HTTP services for the Socora assistant and dashboard.

Contributions are welcome—add documentation when introducing new pipelines or configuration options.